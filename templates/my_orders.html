{% extends "base.html" %}
{% block title %}My Orders{% endblock %}

{% block content %}
<div class="card shadow">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong>
      <i class="fas fa-receipt mr-2"></i>
      {% if user.role == 'admin' %}All Orders{% else %}My Orders{% endif %}
    </strong>
    <a class="btn btn-outline-primary btn-sm rounded-pill" href="{{ url_for('index') }}">
      <i class="fas fa-arrow-left mr-1"></i> Back
    </a>
  </div>

  <div class="card-body">
    {% if orders and orders|length > 0 %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="thead-light">
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Total</th>
            <th>Order Date</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for o in orders %}
          {% set status = o.get('status', 'Pending') %}
          <tr>
            <td class="font-weight-bold">{{ o.get('item_name', 'Unknown') }}</td>
            <td>{{ o.get('quantity', 0) }}</td>
            <td>${{ "%.2f"|format((o.get('total_price', 0) or 0)|float) }}</td>
            <td>
              {% if o.get('order_date') %}
                {{ o.order_date.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if status == 'Completed' %}
                <span class="badge badge-success rounded-pill">Completed</span>
              {% elif status == 'Pending' %}
                <span class="badge badge-warning text-dark rounded-pill">Pending</span>
              {% elif status == 'Cancelled' %}
                <span class="badge badge-danger rounded-pill">Cancelled</span>
              {% else %}
                <span class="badge badge-secondary rounded-pill">{{ status }}</span>
              {% endif %}
            </td>

            <td>
              {% if status == 'Pending' %}
                {% if user.role == 'admin' %}
                  <a class="btn btn-sm btn-success rounded-pill"
                     href="{{ url_for('complete_order', order_id=o._id) }}"
                     onclick="return confirm('Mark this order as Completed?')">
                    <i class="fas fa-check mr-1"></i> Complete
                  </a>
                {% endif %}

                <a class="btn btn-sm btn-outline-danger rounded-pill"
                   href="{{ url_for('cancel_order', order_id=o._id) }}"
                   onclick="return confirm('Cancel this order?')">
                  <i class="fas fa-times mr-1"></i> Cancel
                </a>
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-center text-muted py-5">
        <i class="fas fa-shopping-bag fa-3x mb-3"></i>
        <h5>No orders found</h5>
        <a class="btn btn-primary rounded-pill mt-2" href="{{ url_for('index') }}">
          <i class="fas fa-utensils mr-1"></i> Order Now
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
